# 普通的数据库
- 单点能力上限
- 性能方面
- 安全方面


# 系统流程
- nginx(安全性问题)
- uwsgi
- django
- cache
- database



# 数据分片：分库分表

#### 1000w数据量

    uid = 702312
    
# 按范围拆分(水平拆分的一种)
- Database-0 1-100w
    - table-0 1-10w 
    - table-1 10-20w
    - table-2 20-30w
    - table-3 30-40w
    - table-4 40-50w
    - table-5 50-60w
    - table-6 60-70w
    - table-7 70-80w
    - table-8 80-90w
    - table-9 90-100w

- Database-1 100-200w
- Database-2 200-300w
- Database-3 300-400w
- Database-4 400-500w
- Database-5 500-600w
- Database-6 600-700w <-uid//100w -----时间复o(1)
- Database-7 700-800w
- Database-8 800-900w
- Database-9 900-1000w
#### 按数据库切分
- 并发能力
- 提升单台连接数(200 ~ 500)

### 范围拆分的优缺点
- 优点:
    - 快速扩容能力
    - 程序构建方便
- 缺点:
    - 不能根据运营发展均匀分配负载


# 按取余拆分
uid = 6898948
#### uid % db_num

- Database-0   10  
- Database-1 1 11 21 .... 78781211   
- Database-2 2 12 22 .... 78781212
- Database-3 3 13 23 .... 78781213
- Database-4 4 14 24 .... 78781214
- Database-5 5 15 25 .... 78781215
- Database-6 6 16 26 .... 78781216
- Database-7 7 17 27 .... 78781217
- Database-8 8 18 28 .... 78781218 <-uid
- Database-9 9 19 29 .... 78781219

#### 取余优缺点
- 优点
    - 分布均匀
- 缺点
    - 扩容不方便

# 数据库集群
#### 读写分离
##### 第三方代理实现读写分离

            读写                写操作
    客户端--------->代理服务器------------>mysql主服务器
                    |    　|                  |
                    |    　|读操作             |
                    |    　|                  |
                    v    　v                  |主从同步     
        mysql从服务器１－－－ｍysql从服务器２－－－－

##### 程序自身实现读写分离

                写
    应用服务器-------->mysql主服务器
    |       |               ｜
    |       |               |
    |  读操作|               |  
    v       v               |
    从服务器１，２－－－－－数据同步

# 服务高可用   
- 1.对软硬件冗余，以消除单点故障，任何系统都会有一个或这多个冗余系统做备份
- 2.对故障的检测和恢复，检测故障以及备份的节点接管故障点，也就是＂故障转移＂
- 3.需要很可靠的交汇点(CrossOver)，这是一些不容易冗余的节点，比如域名解析，负载均衡器等